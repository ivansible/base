---
# defaults for ivansible.nginx_base and derived roles

use_sslh: false

web_user: www-data
web_group: www-data

web_domain: example.com
mail_domain: "{{ web_domain }}"

web_ports: [80, 443]

web_force_ssl: false

nginx_letsencrypt_cert: ""
# note: `snakeoil` certificate is generated by the `ssl-cert` Ubuntu package
nginx_ssl_cert:
  "{{ '/etc/ssl/certs/ssl-cert-snakeoil.pem'
      if nginx_letsencrypt_cert == '' else
      '/etc/letsencrypt/live/%s/fullchain.pem' % nginx_letsencrypt_cert }}"
nginx_ssl_key:
  "{{ '/etc/ssl/private/ssl-cert-snakeoil.key'
      if nginx_letsencrypt_cert == '' else
      '/etc/letsencrypt/live/%s/privkey.pem' % nginx_letsencrypt_cert }}"

nginx_conf_dir: /etc/nginx/conf.d
nginx_site_dir: /etc/nginx/sites-enabled

nginx_def_site_dir: /var/www/dummy

uwsgi_base: /etc/uwsgi-emperor
uwsgi_vassals: "{{ uwsgi_base }}/vassals"
uwsgi_plugin_dir: /usr/lib/uwsgi/plugins

#
# nginx configuration snippets
#
nginx_conf_listen_http:
  listen 80;  listen [::]:80;
nginx_conf_listen_ssl_ipv4:
  listen {{ use_sslh | bool | ternary('127.0.0.1:', '') }}443 ssl http2
nginx_conf_listen_ssl_ipv6:
  listen {{ use_sslh | bool | ternary('[::1]','[::]') }}:443 ssl http2
nginx_conf_listen_ssl:
  "{{ nginx_conf_listen_ssl_ipv4 }};  {{ nginx_conf_listen_ssl_ipv6 }};"
nginx_conf_listen:
  "{{ nginx_conf_listen_http }}  {{ nginx_conf_listen_ssl }}"

nginx_conf_favicon:
  location = /favicon.ico { alias {{ nginx_def_site_dir }}/favicon.ico; }
nginx_conf_robots:
  location = /robots.txt { alias {{ nginx_def_site_dir }}/robots.txt; }

nginx_conf_pubcookie_server: ""

nginx_conf_auth: ""

nginx_conf_proxy_params: |
  proxy_redirect off;
  proxy_set_header Host       $host;
  proxy_set_header X-Real-IP  $remote_addr;
  proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto  $scheme;

...
